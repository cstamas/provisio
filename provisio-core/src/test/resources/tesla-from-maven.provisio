# 
# Tesla runtime
#
runtime tesla {
  
  // insert variables in the context
  // $version = ${project.artifactId}
  // We take the dependency management section from this POM
  versionMap => "io.tesla.maven:maven:3.1.1-SNAPSHOT"
  
  //
  // It should be more useful to do removals by GA, provided there was a full inventory of the GAV
  // contained within the distribution. Translate the assembly descriptor.
  //
  root {    
    io.tesla.maven:apache-maven:tar.gz:bin:3.1.1-SNAPSHOT {      
      unpack (
        useRoot => false,
        excludes => "lib/slf4j-simple**,lib/wagon-file*,lib/wagon-http*,bin/**,conf/**"
      )      
    }

    // Task should clean up after itself
    //updateJar (
    //  jar => "lib/maven-core-3.1.1-SNAPSHOT.jar",
    //  updates => {        
    //    "org/apache/maven/messages/build.properties" => "/Users/jvanzyl/js/tesla/tesla-distribution/src/main/proviso/build.properties"
    //    #"META-INF/plexus/components.xml" => "/Users/jvanzyl/js/tesla/tesla-distribution/src/main/proviso/components.xml"                    
    //  } 
    //) 
  }

  //
  // Launcher
  //
  bin {    
    io.tesla.maven:tesla-launcher:0.0.1-SNAPSHOT {      
      unpack (
        excludes => "MANIFEST.MF,.gitattributes,maven/**"
      )      
    }

    executable (
      includes => "**/mvn*",
      excludes => "**/*.bat"
    )
  }  

  //
  // Configuration
  //
  conf {    
    io.tesla.maven:tesla-configuration:0.0.1-SNAPSHOT {      
      unpack (
        excludes => "MANIFEST.MF,.gitattributes,maven/**"
      )      
    }
  }  


  lib {
    ch.qos.logback:logback-core:1.0.7
    ch.qos.logback:logback-classic:1.0.7    
    org.eclipse.aether:aether-connector-file:0.9.0.M2
    io.tesla.aether:aether-connector-okhttp:0.0.3
  }   
  
  lib/ext {
    io.tesla.aether:tesla-concurrent-localrepo:0.0.1
  }
  
  // Archive
  archive (
    name => "tesla-3.1.1-SNAPSHOT.tar.gz"
  )
}
