<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE Configure PUBLIC "-//Jetty//Configure//EN" "http://www.eclipse.org/jetty/configure.dtd">

<Configure id="Server" class="org.eclipse.jetty.server.Server">
  <Set name="ThreadPool">
    <New class="org.eclipse.jetty.util.thread.QueuedThreadPool">
      <Set name="minThreads">10</Set>
      <Set name="maxThreads">200</Set>
    </New>
  </Set>

  <Call name="addConnector">
    <Arg>
      <New class="org.eclipse.jetty.server.nio.SelectChannelConnector">
        <Set name="host">
          <SystemProperty name="jetty.host" />
        </Set>
        <Set name="port">
          <SystemProperty name="jetty.port" default="${jettyPort}" />
        </Set>
        <Set name="maxIdleTime">300000</Set>
        <Set name="Acceptors">2</Set>
        <Set name="statsOn">false</Set>
        <Set name="lowResourcesConnections">20000</Set>
        <Set name="lowResourcesMaxIdleTime">5000</Set>
      </New>
    </Arg>
  </Call>

  <Set name="handler">
    <New id="Handlers" class="org.eclipse.jetty.server.handler.HandlerCollection">
      <Set name="handlers">
        <Array type="org.eclipse.jetty.server.Handler">
          <Item>
            <New id="Contexts" class="org.eclipse.jetty.server.handler.ContextHandlerCollection" />
          </Item>
          <Item>
            <New class="org.eclipse.jetty.server.handler.ResourceHandler">
              <Set name="directoriesListed">true</Set>
              <Set name="welcomeFiles">
                <Array type="String">
                  <Item>index.html</Item>
                </Array>
              </Set>
              <Set name="resourceBase"><SystemProperty name="jetty.home" default="." />/site</Set>
            </New>
          </Item>
          <Item>
            <New id="RequestLog" class="org.eclipse.jetty.server.handler.RequestLogHandler" />
          </Item>
        </Array>
      </Set>
    </New>
  </Set>

  <Call name="addBean">
    <Arg>
      <New id="DeploymentManager" class="org.eclipse.jetty.deploy.DeploymentManager">
        <Set name="contexts">
          <Ref id="Contexts" />
        </Set>
        <Call name="addAppProvider">
          <Arg>
            <!-- 
             |
             | http://wiki.eclipse.org/Jetty/Feature/ContextDeployer 
             |
             -->
            <New class="org.eclipse.jetty.deploy.providers.ContextProvider">
              <Set name="monitoredDir">
                <Property name="jetty.home" default="." />/etc/contexts</Set>
              <!--
               |
               | If the scan interval is non-zero, the ContextProvider scans the configuration directory at that interval (in seconds)
               | for changes to the deployment descriptors. If you add a descriptor to the directory, it deploys the new context. 
               | If you touch or update a descriptor, the provider stops, reconfigures, and redeploys its context. If you remove 
               | a descriptor, the provider stops and removes its context from the server.
               |
               | If the scan interval is zero, the ContextProvider scans the directory only at startup.
               |
               -->
              <Set name="scanInterval">0</Set>
            </New>
          </Arg>
        </Call>
      </New>
    </Arg>
  </Call>

  <Call name="addBean">
    <Arg>
      <New class="org.eclipse.jetty.security.HashLoginService">
        <Set name="name">Default Realm</Set>
      </New>
    </Arg>
  </Call>

  <Ref id="RequestLog">
    <Set name="requestLog">
      <New id="RequestLogImpl" class="org.eclipse.jetty.server.NCSARequestLog">
        <Set name="filename">
          <SystemProperty name="jetty.home" default="." />/var/log/request-yyyy_mm_dd.log</Set>
        <Set name="filenameDateFormat">yyyy-MM-dd</Set>
        <Set name="retainDays">14</Set>
        <Set name="append">true</Set>
        <Set name="extended">false</Set>
        <Set name="logCookies">false</Set>
        <Set name="LogTimeZone">GMT</Set>
      </New>
    </Set>
  </Ref>

  <Set name="stopAtShutdown">true</Set>
  <Set name="sendServerVersion">true</Set>
  <Set name="sendDateHeader">true</Set>
  <Set name="gracefulShutdown">1000</Set>

</Configure>

